<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.example.user.service.impl.UserManageMapper">
	
	<select id="selectUserInfo" parameterType="hashmap" resultType="loginVO">
		select
			USER_SE_CODE as id,
			USER_NM as name,
			PHOTO_STRE_FILE_NM as profileImageId,
			TEACHER_SE_CODE as userType,
			SCHUL_CODE as userSpaceInfo,
			concat(ST_GRADE, '학년 ', ST_CLASS, '반') as userSpaceOrgInfo,
			USER_ID as uniqId,
			CONFM_AT as isFirstInvite,
			SEXDSTN as sex,
			EMAIL_ADRES as userEmail
		from survey.comtnmber
		where USER_ID = #{uniqId}
	</select>
	
	<insert id="insertUserInfo" parameterType="hashmap">
		insert into survey.comtnmber(
			USER_ID, 
			USER_SE_CODE,
			PASSWORD, 
			USER_NM, 
			PHOTO_STRE_FILE_NM
			EMAIL_ADRES, 
			SEXDSTN, 
			CONFM_AT, 
			ST_GRADE, 
			ST_CLASS, 
			TEACHER_SE_CODE, 
			SCHUL_CODE
		)
		values (
			#{uniqId},
			#{id},
			#{password},
			#{name},
			#{profileImageId}, 
			#{userEmail},
			#{sex}, 
			'N', 
			#{gradeNm},
			#{classNm},
			#{userType},
			#{userSpaceInfo}
		)
	</insert>
	
	<insert id="insertUserScrtyEstbs" parameterType="hashmap">
		insert into survey.comtnemplyrscrtyestbs(SCRTY_DTRMN_TRGET_ID, AUTHOR_CODE)
		values (#{uniqId}, #{role})
	</insert>
	
	<update id="updateUserInfo" parameterType="hashmap">
		update survey.comtnmber
		set
			USER_NM = #{name}, 
			PASSWORD = #{password}, 
			PHOTO_STRE_FILE_NM = #{profileImageId}, 
			EMAIL_ADRES = #{userEmail}, 
			SEXDSTN = #{sex}, 
			TEACHER_SE_CODE = #{userType}, 
			SCHUL_CODE = #{userSpaceInfo}, 
			ST_GRADE = #{gradeNm},
			ST_CLASS = #{classNm},
		where USER_ID = #{uniqId};
	</update>

</mapper>